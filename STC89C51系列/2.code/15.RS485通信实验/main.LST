C51 COMPILER V9.01   MAIN                                                                  06/11/2024 16:50:45 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\dianzi\Keil C51\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************************
   2          深圳市普中科技有限公司（PRECHIN 普中）
   3          技术支持：www.prechin.net
   4          PRECHIN
   5           普中
   6           
   7          实验名称：RS485通信实验
   8          接线说明：      
   9          实验现象：下载程序后，当串口助手发送数据给单片机，单片机原封不动转发给串口助手显示
  10          注意事项：                                                                                                                                                                
  11          ***************************************************************************************/
  12          #include "reg52.h"
  13          
  14          typedef unsigned int u16;       //对系统默认数据类型进行重定义
  15          typedef unsigned char u8;
  16          
  17          
  18          //定义控制引脚IO
  19          sbit RS485_DIR=P1^0;//发送和接收控制
  20          
  21          
  22          /*******************************************************************************
  23          * 函 数 名       : delay_10us
  24          * 函数功能               : 延时函数，ten_us=1时，大约延时10us
  25          * 输    入       : ten_us
  26          * 输    出       : 无
  27          *******************************************************************************/
  28          void delay_10us(u16 ten_us)
  29          {
  30   1              while(ten_us--);        
  31   1      }
  32          
  33          /*******************************************************************************
  34          * 函 数 名       : uart_init
  35          * 函数功能               : 串口通信中断配置函数，通过设置TH和TL即可确定定时时间
  36          * 输    入       : baud：波特率对应的TH、TL装载值
  37          * 输    出       : 无
  38          *******************************************************************************/
  39          void uart_init(u8 baud)
  40          {
  41   1              TMOD|=0X20;     //设置计数器工作方式2
  42   1              SCON=0X50;      //设置为工作方式1
  43   1              PCON=0X80;      //波特率加倍
  44   1              TH1=baud;       //计数器初始值设置
  45   1              TL1=baud;
  46   1              ES=1;           //打开接收中断
  47   1              EA=1;           //打开总中断
  48   1              TR1=1;          //打开计数器            
  49   1      }
  50          
  51          /*******************************************************************************
  52          * 函 数 名       : main
  53          * 函数功能               : 主函数
  54          * 输    入       : 无
  55          * 输    出       : 无
C51 COMPILER V9.01   MAIN                                                                  06/11/2024 16:50:45 PAGE 2   

  56          *******************************************************************************/
  57          void main()
  58          {       
  59   1              uart_init(0XFA);//波特率为9600
  60   1              RS485_DIR=0;//配置RS485为接收模式
  61   1              while(1)
  62   1              {                       
  63   2                                                              
  64   2              }               
  65   1      }
  66          
  67          void uart() interrupt 4 //串口通信中断函数
  68          {
  69   1              u8 rec_data;
  70   1      
  71   1              RI = 0;                 //清除接收中断标志位
  72   1              rec_data=SBUF;  //存储接收到的数据
  73   1              delay_10us(100);
  74   1              RS485_DIR=1;//配置RS485为发送模式
  75   1              SBUF=rec_data;  //将接收到的数据放入到发送寄存器
  76   1              while(!TI);             //等待发送数据完成
  77   1              TI=0;                   //清除发送完成标志位
  78   1              RS485_DIR=0;//配置RS485为接收模式                               
  79   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     90    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
