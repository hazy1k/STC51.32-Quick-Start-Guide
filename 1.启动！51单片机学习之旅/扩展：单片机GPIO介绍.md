# 扩展：单片机GPIO介绍

## 1. GPIO概念

    GPIO（ general purpose intput output） 是通用输入输出端口的简称， 可以通过软件来控制其输入和输出。 51 单片机芯片的 GPIO 引脚与外部设备连接起来， 从而实现与外部通讯、 控制以及数据采集的功能。 不过 GPIO 最简单的应用还属点亮 LED 灯了， 只需通过软件控制 GPIO 输出高低电平即可。 当然 GPIO还可以作为输入控制， 比如在引脚上接入一个按键， 通过电平的高低判断按键是否按下。

    那么是不是所有引脚都是 GPIO 呢？ 当然不是， 51 单片机引脚可以分为这么几大类：

![](https://www.dzsc.com/uploadfile/company/125417/b201317113448398.jpg)

- 电源引脚： 引脚图中的 VCC、 GND 都属于电源引脚。

- 晶振引脚： 引脚图中的 XTAL1、 XTAL2 都属于晶振引脚。

- 复位引脚： 引脚图中的 RST/VPD 属于复位引脚， 不做其他功能使用。

- 下载引脚： 51 单片机的串口功能引脚（ TXD、 RXD） 可以作为下载引脚使用。

- GPIO 引脚： 引脚图中带有 Px.x 等字样的均属于 GPIO 引脚。 从引脚图可以看出， GPIO 占用了芯片大部分的引脚， 共达 32 个， 分为了 4 组， P0、 P1、P2、 P3， 每组为 8 个 IO， 而且在 P3 组中每个 IO 都具备额外功能， 只要通过相应的寄存器设置即可配置对应的附加功能， 同一时刻， 每个引脚只能使用该引脚的一个功能

## 2. GPIO结构框图与工作原理

    我们使用的 51 单片机 GPIO 分为 P0、 P1、 P2 和 P3 口， 下面分别来介绍其内部结构框图与工作原理。

### 2.1 P0端口

    P0 端口含有 8 位引脚， 下图为其中一个， 其它几个与之完全一致， 因此只需了解当中一个即可。 如下图所示：

![](https://img.picgo.net/2024/06/01/-2024-06-01-15492927f9136357dc8e23.png)

    由图可见，P0 端口由锁存器、 输入缓冲器、 切换开关、 一个非门、 一个与非门及场效应管驱动电路构成。 再看图的最右边， 标号为 P0.x 引脚的图标， 也就是说 P0.x 引脚可以是 P0.0 到 P0.7 的任何一位， 即在 P0 口有 8 个与上图相同的电路组成。

- 输入缓冲器

    在 P0 口中， 有两个三态的缓冲器， 在学数字电路时， 我们已知道， 三态门有三个状态， 即在输出端可以是高电平、 低电平， 同时还有一种就是高阻状态（ 或称为禁止状态） ， 大家看上图， 上面一个是读锁存器的缓冲器， 也就是说， 要读取 D 锁存器输出端 Q 的数据， 那就得使读锁存器的这个缓冲器的三态控制端（ 上图中标号为‘ 读锁存器’ 端） 有效。 下面一个是读引脚的缓冲器， 要读取 P0.x引脚上的数据， 也要使标号为‘ 读引脚’ 的这个三态缓冲器的控制端有效， 引脚上的数据才会传输到我们单片机的内部数据总线上。

- D锁存器

    构成一个锁存器， 通常要用一个时序电路， 时序的单元电路在学数字电路时我们已知道， 一个触发器可以保存一位的二进制数（ 即具有保持功能） ， 在 51单片机的 32 根 I/O 口线中都是用一个 D 触发器来构成锁存器的。 大家看上图中的 D 锁存器， D 端是数据输入端， CP（ CLK） 是控制端（ 也就是时序控制信号输入端） ， Q 是输出端， Q 非是反向输出端。

    对于 D 触发器来讲， 当 D 输入端有一个输入信号， 如果这时控制端 CP 没有信号（ 也就是时序脉冲没有到来） ， 这时输入端 D 的数据是无法传输到输出端 Q及反向输出端 Q 非的。 如果时序控制端 CP 的时序脉冲一旦到了， 这时 D 端输入的数据就会传输到 Q 及 Q 非端。 数据传送过来后， 当 CP 时序控制端的时序信号消失了， 这时， 输出端还会保持着上次输入端 D 的数据（ 即把上次的数据锁存起来了） 。 如果下一个时序控制脉冲信号来了， 这时 D 端的数据才再次传送到 Q端， 从而改变 Q 端的状态。

- 多路开关

    在 51 单片机中， 当内部的存储器够用（ 也就是不需要外扩展存储器时， 这里讲的存储器包括数据存储器及程序存储器） 时， P0 口可以作为通用的输入输出端口（ 即 I/O） 使用， 对于 8031（ 内部没有 ROM） 的单片机或者编写的程序超过了单片机内部的存储器容量， 需要外扩存储器时， P0 口就作为‘ 地址/数据’总线使用。 那么这个多路选择开关就是用于选择是做为普通 I/O 口使用还是作为‘ 数据/地址’ 总线使用的选择开关了。 大家看上图， 当多路开关与下面接通时， P0 口是作为普通的 I/O 口使用的， 当多路开关是与上面接通时， P0 口是作为‘ 地址/数据’ 总线使用的。

- 场效应管输出驱动

    从上图中可以看出， P0 口的输出是由两个 MOS 管组成的推拉式结构， 也就是说， 这两个 MOS 管一次只能导通一个， 当 V1 导通时， V2 就截止， 当 V2 导通时， V1 截止。

-  与非门、非门

    学过数电的都应该知道，与非门就是 !(A&&B)：当输入端中有1个或1个以上是低电平时，输出为高电平；只有所有输入是高电平时，输出才是低电平。，非门!A：输出结果与输出相反。
